import koffi from 'koffi';
import * as util from "util";
import host from "./host.js";
const filename = host().platform == 'darwin' ? '/usr/lib/libSystem.dylib' : 'libc.so.6';
const libc = koffi.load(filename);
const LOCK_EX = 2;
const LOCK_UN = 8;
const cflock = libc.func('int flock(int, int)');
const flockAsync = util.promisify(cflock.async);
async function flock(fd, op) {
    const rv = await flockAsync(fd, op == 'ex' ? LOCK_EX : LOCK_UN);
    if (rv === -1) {
        throw new Error("flock failed"); // TODO read errno
    }
}
export { flock };
